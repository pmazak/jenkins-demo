def HUDSON_VERSION = 1.398
def JENKINS_VERSION = 1.405

apply plugin: 'jetty'    
defaultTasks "opts"
port = System.properties['port'] ? Integer.parseInt(System.properties['port']) : 8080
buildDir = "build/$port"

task opts << {
    println """Usage: gradle [hudson|jenkins]-[basic|intermediate|expert]
 Examples: 
          gradle hudson-basic
          gradle jenkins-intermediate
"""
}
task "hudson-basic" << {
    configJetty("http://java.net/downloads/hudson/war/hudson-${HUDSON_VERSION}.war",
        "hudson-${HUDSON_VERSION}.war", "hudson-basic")
    jettyRunWar.execute()
}
task "jenkins-basic" << {
    def ciName = "jenkins"
    if (JENKINS_VERSION < 1.396) {
        ciName = "hudson"
    }
    configJetty("http://mirrors.jenkins-ci.org/war/${JENKINS_VERSION}/${ciName}.war",
        "jenkins-${JENKINS_VERSION}.war", "jenkins-basic")
    jettyRunWar.execute()
}
def configJetty(downloadUrl, fileName, ciName) {
    clean.execute()
    ant.get(src:downloadUrl, dest:".gradle/$fileName", skipexisting:true, verbose:true)
    jettyRunWar {
        httpPort = port
        System.setProperty("HUDSON_HOME", "config/.$ciName")
        contextPath = ciName
        webApp = new File(".gradle/$fileName")
        doFirst {
            println """
Server is up!
    Browse to: http://localhost:$port/$contextPath
  (Control-C to stop)
"""
        }
    }
}
task commitabunch {
    def rand = new Random()
    def str = "fixed a bug with the media content not wanting to shape the circle properly like the square was shaped working on unit test for class that seemed difficult"
    def strs = str.split(' ')
    def randCommits = rand.nextInt(21)+1
    (1..randCommits).each {
       def randNum = rand.nextInt(101)+1
       def randStr = ""
       (0..10).each {
           randStr += " " + strs[rand.nextInt(strs.length)]
       }
       def comment = "QC-$randNum:$randStr"
       new File("commitabunch.txt") << "// $comment\n"
       ant.exec(command:"git commit -am '$comment'")
    }
}